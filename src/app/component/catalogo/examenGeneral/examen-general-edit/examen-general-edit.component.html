<div class="row all-table">
  <div class="col-md-12">
    <div class="row">
      <div class="col-md-6">
        <span class="title-catalogos">{{edit ? 'Editar Examen': 'Crear Examen'}}</span>
      </div>
    </div>
    <mat-card class="form-edit">
      <form class="col-md-12" [formGroup]="formExamen"
        (ngSubmit)="edit ? updateExamenGeneral(): saveNewExamenGeneral()">
        <div class="row">
          <div class="col-md-6">
            <h5>Datos del examen</h5>
          </div>
          <div class="col-md-6 text-right buttons-catalogo">
            <button mat-button id="examenGeneralEstado" (click)="activarInactivar()"></button>
            <button mat-flat-button color="primary" id="examenGeneralGuardar"
              [disabled]="!examenGeneral.estado || !formExamen.valid">Guardar</button>
            <button mat-flat-button color="warn" (click)="cancelarEdicion()">Cancelar</button>
          </div>
        </div>

        <div class="row margin-up">
          <div class="col-md-4">
            <mat-form-field class="input-full-width">
              <mat-label>Nombre</mat-label>
              <input matInput formControlName="nombre" required type="text">
              <mat-error *ngIf="examenNombreCtrl.hasError('required')">
                El nombre es obligatorio
              </mat-error>
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field class="input-full-width">
              <mat-label>Alias</mat-label>
              <input matInput formControlName="alias" type="text">
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field class="input-full-width">
              <mat-label>Titulo examen</mat-label>
              <input matInput formControlName="titulo" type="text">
            </mat-form-field>
          </div>
        </div>

        <div class="row margin-up">
          <div class="col-md-4">
            <mat-form-field class="input-full-width">
              <mat-label>Clave del examen</mat-label>
              <input matInput formControlName="clave" type="text">
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field class="input-full-width">
              <mat-label>Categoría</mat-label>
              <mat-select formControlName="categoriaId" required>
                <mat-option *ngFor="let categoria of Categoria" [value]="categoria.categoriaId">{{categoria.nombre}}
                </mat-option>
              </mat-select>
              <mat-error *ngIf="examenCategoriaCtrl.hasError('required')">
                La categoria es obligatoria
              </mat-error>
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field class="input-full-width">
              <mat-label>Precio</mat-label>
              <input matInput type="number" formControlName="precio">
              <span matPrefix>$&nbsp;</span>
            </mat-form-field>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <small>Fecha creación: {{examenGeneral.fechaCreacion}}</small>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12">
            <small>Fecha actualización: {{examenGeneral.fechaActualizacion}} </small>
          </div>
        </div>
      </form>
    </mat-card>

    <mat-card class="form-edit">
      <div class="row">
        <div class="col-md-6">
          <h5>Estudios del examen</h5>
        </div>
      </div>
      <ng-template [ngIf]="ExamenSeccion != null && ExamenSeccion != []">
        <div class="row margin-up">
          <div class="col-md-12">
            <div class="alert alert-warning alert-dismissible fade show" role="alert">
              ¡Sin secciones ni estudios agregados!
              <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
          </div>
        </div>
        <div class="row margin-up">
          <div class="col-md-12 text-right buttons-catalogo">
            <button mat-raised-button id="addEstudio">Añadir examen</button>
            <button mat-raised-button color="primary" id="addSeccion">Añadir Seccion</button>
          </div>
        </div>
      </ng-template>
      <div class="row margin-up" *ngFor="let seccion of ExamenSeccion">
        <div class="col-md-12">
          <p>{{seccion.seccion.titulo}}</p>
        </div>
        <mat-accordion *ngFor="let estudio of seccion.estudio" class="form-edit col-md-12">
          <mat-expansion-panel (afterExpand)="obtenerReferencia(estudio.estudioId)">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <button class="fas fa-times" matTooltip="Remover examen"
                  (click)="removerExamenGeneral(seleccion.EXAMEN_GEN_ID)"></button>
                &nbsp;
                {{estudio.nombre}}
              </mat-panel-title>
              <mat-panel-description>
                <div class="width-100 text-right">

                </div>
              </mat-panel-description>
            </mat-expansion-panel-header>

            <div class="row">
              <div class="col-md-6">
                Referencias:
                <mat-list role="list" *ngFor="let referencia of ReferenciaEstudio">
                  <mat-list-item role="listitem"><strong>{{referencia.clasificacion.nombre}}</strong></mat-list-item>
                  <mat-list-item role="listitem">Femenino: {{referencia.referenciaFemenino}}</mat-list-item>
                  <mat-list-item role="listitem">Masculino: {{referencia.referenciaMasculino}}</mat-list-item>
                  <mat-list-item role="listitem">General: {{referencia.referenciaGeneral}}</mat-list-item>
                </mat-list>
                <button mat-stroked-button (click)="openDialogReferencia(estudio.estudioId)">¿Nueva referencia?</button>
              </div>
              <div class="col-md-6">
                Metodos:
              </div>
            </div>
          </mat-expansion-panel>
        </mat-accordion>

        <div class="col-md-12 margin-up-down">
          <div class="row">
            <div class="col-md-2">
              <button class="input-full-width" mat-button color="primary" (click)="openDialog()">Añadir metodo</button>
            </div>
            <div class="col-md-10">
              <mat-chip-list aria-label="Seleccion de metodo">
                <mat-chip [selectable]="selectable" [removable]="removable" (removed)="remove(1)"
                  *ngFor="let metodo of seccion.metodo">
                  {{metodo.nombre}}
                  <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
                </mat-chip>
              </mat-chip-list>
            </div>
          </div>
        </div>
      </div>

    </mat-card>

    <mat-card class="form-edit">
      <div class="row margin-up-down">
        <div class="col-md-2">
          <button class="input-full-width" mat-button color="primary" matTooltip="Añadir metodo general para el examen"
            (click)="openDialog()">Añadir metodo</button>
        </div>
        <div class="col-md-10">
          <mat-chip-list aria-label="Fish selection">
            <mat-chip [selectable]="selectable" [removable]="removable" (removed)="remove(1)">
              Centrifugado
              <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
            </mat-chip>
          </mat-chip-list>
        </div>
      </div>
    </mat-card>
  </div>
</div>